# BacarratBot v2 - æ¶æ§‹è¨­è¨ˆæ–‡æª”

## ç•¶å‰å•é¡Œ

1. **è·è²¬é‡ç–Š**: PhaseDetector å’Œ RoundManager éƒ½åœ¨ç®¡ç†éšæ®µ
2. **é‚è¼¯åˆ†æ•£**: ä¸‹æ³¨ã€çµç®—ã€ä¿¡è™Ÿç™¼é€æ•£è½åœ¨å¤šå€‹æ–‡ä»¶
3. **é›£ä»¥ç¶­è­·**: ä¿¡è™Ÿéˆè·¯è¤‡é›œï¼Œèª¿è©¦å›°é›£

## æ¨è–¦æ¶æ§‹

### æ ¸å¿ƒåŸå‰‡

1. **å–®ä¸€è·è²¬**: æ¯å€‹çµ„ä»¶åªåšä¸€ä»¶äº‹
2. **å–®å‘æ•¸æ“šæµ**: äº‹ä»¶åªèƒ½å‘ä¸‹æ¸¸å‚³æ’­
3. **æ˜ç¢ºæ‰€æœ‰æ¬Š**: æ¯å€‹æ•¸æ“šåªæœ‰ä¸€å€‹ source of truth

### çµ„ä»¶è·è²¬åŠƒåˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        UI Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Dashboard   â”‚  â”‚ NextBetCard  â”‚  â”‚  LogViewer   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                            â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ Signals
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Worker Layer                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚ EngineWorker   â”‚                        â”‚
â”‚                    â”‚ (å”èª¿è€…)        â”‚                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                             â”‚                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                    â”‚   EventBus     â”‚  â† ä¸­å¤®äº‹ä»¶ç¸½ç·š        â”‚
â”‚                    â”‚  (çµ±ä¸€åˆ†ç™¼)     â”‚                        â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                             â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ Events
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Core Layer                                â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚           RoundManager (å±€ç®¡ç†å™¨)                â”‚        â”‚
â”‚  â”‚  è·è²¬:                                            â”‚        â”‚
â”‚  â”‚  - ç”Ÿæˆå’Œè¿½è¹¤ round_id                           â”‚        â”‚
â”‚  â”‚  - ç®¡ç†å±€çš„ç”Ÿå‘½é€±æœŸ (éšæ®µè½‰æ›)                    â”‚        â”‚
â”‚  â”‚  - è¿½è¹¤åƒèˆ‡ç‹€æ…‹ (is_participated)               â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                     â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚      StrategyEngine (ç­–ç•¥å¼•æ“)                â”‚           â”‚
â”‚  â”‚  è·è²¬:                                         â”‚           â”‚
â”‚  â”‚  - è©•ä¼°ç­–ç•¥è§¸ç™¼                                â”‚           â”‚
â”‚  â”‚  - ç”Ÿæˆä¸‹æ³¨æ±ºç­–                                â”‚           â”‚
â”‚  â”‚  - ç®¡ç†ç­–ç•¥ç‹€æ…‹                                â”‚           â”‚
â”‚  â”‚  - ç¶­è­·æ­·å²è¨˜éŒ„ (åªè¨˜éŒ„è§€å¯Ÿå±€)                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                     â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚      PositionManager (å€‰ä½ç®¡ç†å™¨)             â”‚           â”‚
â”‚  â”‚  è·è²¬:                                         â”‚           â”‚
â”‚  â”‚  - è¿½è¹¤æ´»èºå€‰ä½                                â”‚           â”‚
â”‚  â”‚  - è¨ˆç®—ç›ˆè™§                                    â”‚           â”‚
â”‚  â”‚  - ç®¡ç†è³‡é‡‘                                    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                     â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚      ExecutionEngine (åŸ·è¡Œå¼•æ“)               â”‚           â”‚
â”‚  â”‚  è·è²¬:                                         â”‚           â”‚
â”‚  â”‚  - è¦åŠƒç±Œç¢¼é…æ–¹                                â”‚           â”‚
â”‚  â”‚  - åŸ·è¡Œä¸‹æ³¨åºåˆ—                                â”‚           â”‚
â”‚  â”‚  - è™•ç†å¤±æ•—å’Œå›æ»¾                              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº‹ä»¶æµ (ä½¿ç”¨ EventBus)

```
1. BeadPlateResultDetector æª¢æ¸¬åˆ°çµæœ
   â†“
   EventBus.publish(RESULT_DETECTED)
   â†“
2. RoundManager è¨‚é–± RESULT_DETECTED
   - å‰µå»ºæ–°å±€
   - å•Ÿå‹•éšæ®µè¨ˆæ™‚å™¨
   â†“
   EventBus.publish(PHASE_CHANGED, phase=BETTABLE)
   â†“
3. StrategyEngine è¨‚é–± PHASE_CHANGED
   - è©•ä¼°ç­–ç•¥è§¸ç™¼
   â†“
   EventBus.publish(STRATEGY_TRIGGERED)
   â†“
4. PositionManager è¨‚é–± STRATEGY_TRIGGERED
   - å‰µå»ºå€‰ä½
   â†“
   EventBus.publish(BET_DECISION)
   â†“
5. ExecutionEngine è¨‚é–± BET_DECISION
   - åŸ·è¡Œä¸‹æ³¨
   â†“
   EventBus.publish(BET_EXECUTED)
   â†“
6. RoundManager è¨‚é–± BET_EXECUTED
   - æ¨™è¨˜åƒèˆ‡å±€
   â†“
7. UI è¨‚é–± BET_EXECUTED
   - é¡¯ç¤º NextBetCard
   â†“
8. æª¢æ¸¬åˆ°æ–°çµæœ
   â†“
   EventBus.publish(RESULT_DETECTED)
   â†“
9. PositionManager è¨‚é–± RESULT_DETECTED
   - çµç®—å€‰ä½
   â†“
   EventBus.publish(POSITION_SETTLED)
   â†“
10. StrategyEngine è¨‚é–± POSITION_SETTLED
    - æ›´æ–°å±¤æ•¸
    - åªæœ‰è§€å¯Ÿå±€æ‰è¨˜éŒ„åˆ°æ­·å²
   â†“
11. UI è¨‚é–± POSITION_SETTLED
    - æ›´æ–° NextBetCard é¡¯ç¤ºçµæœ
```

### æ•¸æ“šæ‰€æœ‰æ¬Š

| æ•¸æ“š | Owner | å…¶ä»–çµ„ä»¶å¦‚ä½•è¨ªå• |
|------|-------|------------------|
| round_id | RoundManager | é€šéäº‹ä»¶å‚³é |
| å±€çš„éšæ®µ | RoundManager | è¨‚é–± PHASE_CHANGED |
| åƒèˆ‡ç‹€æ…‹ | RoundManager | æŸ¥è©¢æ¥å£ |
| ç­–ç•¥è§¸ç™¼ | StrategyEngine | ç™¼å¸ƒ STRATEGY_TRIGGERED |
| æ­·å²è¨˜éŒ„ | StrategyEngine | åªè¨˜éŒ„è§€å¯Ÿå±€ |
| æ´»èºå€‰ä½ | PositionManager | è¨‚é–± BET_DECISION |
| ç›ˆè™§è¨ˆç®— | PositionManager | è¨‚é–± RESULT_DETECTED |

## é‡æ§‹è·¯ç·šåœ–

### éšæ®µ 1: å¼•å…¥ EventBus (1-2å¤©)
- âœ… å‰µå»º EventBus
- åœ¨ EngineWorker ä¸­åˆå§‹åŒ–
- é€æ­¥é·ç§»ç¾æœ‰ä¿¡è™Ÿåˆ° EventBus

### éšæ®µ 2: é‡æ§‹ RoundManager (2-3å¤©)
- ç§»é™¤ PhaseDetectorï¼ˆåŠŸèƒ½åˆä½µåˆ° RoundManagerï¼‰
- RoundManager è² è²¬è¨ˆæ™‚ + ç‹€æ…‹ç®¡ç†
- è¨‚é–± RESULT_DETECTEDï¼Œç™¼å¸ƒ PHASE_CHANGED

### éšæ®µ 3: æ‹†åˆ† LineOrchestrator (3-5å¤©)
- å‰µå»º StrategyEngineï¼ˆç­–ç•¥è©•ä¼° + æ­·å²è¨˜éŒ„ï¼‰
- å‰µå»º PositionManagerï¼ˆå€‰ä½è¿½è¹¤ + ç›ˆè™§è¨ˆç®—ï¼‰
- é·ç§» _pendingã€handle_result é‚è¼¯

### éšæ®µ 4: é‡æ§‹ EngineWorker (2-3å¤©)
- å¾"å¤§é›œç‡´"è®Šæˆ"å”èª¿è€…"
- åªè² è²¬å•Ÿå‹•çµ„ä»¶å’Œé€£æ¥ EventBus
- ä¸å†ç›´æ¥è™•ç†æ¥­å‹™é‚è¼¯

### éšæ®µ 5: UI å±¤è§£è€¦ (1-2å¤©)
- UI ç›´æ¥è¨‚é–± EventBus
- ç§»é™¤ EngineWorker çš„ä¿¡è™Ÿä¸­è½‰

## ç•¶å‰å¯ä»¥åšçš„æœ€å°æ”¹å‹•

å¦‚æœç¾åœ¨é‚„ä¸æƒ³å¤§é‡æ§‹ï¼Œè‡³å°‘å¯ä»¥ï¼š

1. âœ… **ä¿ç•™ RoundManager**ï¼ˆå·²å®Œæˆï¼‰
   - çµ±ä¸€ round_id ç”Ÿæˆ
   - è¿½è¹¤åƒèˆ‡ç‹€æ…‹

2. **ç°¡åŒ– PhaseDetector**
   - åªä¿ç•™è¨ˆæ™‚åŠŸèƒ½
   - ç§»é™¤ round_id ç”Ÿæˆï¼ˆç”± RoundManager è² è²¬ï¼‰

3. **æ•´ç† LineOrchestrator.handle_result**
   - âœ… åƒèˆ‡å±€ä¸è¨˜éŒ„æ­·å²ï¼ˆå·²å®Œæˆï¼‰
   - æ·»åŠ æ¸…æ™°çš„è¨»é‡‹

4. **æ·»åŠ æ¶æ§‹æ–‡æª”**
   - âœ… è¨˜éŒ„çµ„ä»¶è·è²¬ï¼ˆæœ¬æ–‡ä»¶ï¼‰
   - è¨˜éŒ„æ•¸æ“šæµ

## P0 ç·Šæ€¥ä¿®å¾©ï¼ˆå·²å®Œæˆï¼‰

> **å®Œæˆæ—¥æœŸ**: 2025-10-24
> **æ¸¬è©¦é©—è­‰**: test_p0_fixes.py å…¨éƒ¨é€šé âœ…

### 1. âœ… ç§»é™¤éæ™‚çš„ net profit è¿½è¹¤

**å•é¡Œ**: `AutoBetEngine.net` èˆ‡ `LineOrchestrator` çš„ PnL è¨ˆç®—é‡è¤‡ï¼Œé€ æˆæ··æ·†ã€‚

**ä¿®å¾©**:
- ç§»é™¤ `AutoBetEngine.net` å±¬æ€§
- ç§»é™¤ `get_status()` ä¸­çš„ `net` å­—æ®µ
- æ›´æ–° CSV æ—¥èªŒæ ¼å¼ï¼ˆç§»é™¤ net æ¬„ä½ï¼‰
- ç›ˆè™§çµ±ä¸€ç”± `LineOrchestrator` è¨ˆç®—

**å½±éŸ¿æ–‡ä»¶**:
- `src/autobet/autobet_engine.py` (line 45, 57, 402, 433)

**æ¸¬è©¦**: `test_deprecated_net_removal()` âœ…

---

### 2. âœ… ä¿®å¾©åƒèˆ‡å±€æ’é™¤é‚è¼¯

**å•é¡Œ**: åƒèˆ‡çš„å±€ï¼ˆæœ‰ä¸‹æ³¨ï¼‰ä»è¢«è¨˜éŒ„åˆ°ç­–ç•¥æ­·å²ï¼Œå°è‡´ç­–ç•¥åˆ¤æ–·éŒ¯èª¤ã€‚

**æ ¹æœ¬åŸå› **: `LineOrchestrator.handle_result()` å…ˆèª¿ç”¨ `tracker.record()`ï¼Œå†æª¢æŸ¥ `_pending`ã€‚

**ä¿®å¾©**:
- èª¿æ•´é‚è¼¯é †åºï¼š**å…ˆæª¢æŸ¥ `_pending`**ï¼Œå†æ±ºå®šæ˜¯å¦è¨˜éŒ„æ­·å²
- è§€å¯Ÿå±€ï¼ˆç„¡ pending positionï¼‰â†’ è¨˜éŒ„åˆ°æ­·å²
- åƒèˆ‡å±€ï¼ˆæœ‰ pending positionï¼‰â†’ ä¸è¨˜éŒ„ï¼Œç›´æ¥çµç®—

**å½±éŸ¿æ–‡ä»¶**:
- `src/autobet/lines/orchestrator.py` (line 445-476)

**æ¸¬è©¦**: `test_orchestrator_participation_exclusion()` âœ…

**é—œéµä»£ç¢¼**:
```python
# å…ˆæª¢æŸ¥æ˜¯å¦æœ‰å¾…è™•ç†å€‰ä½ï¼ˆåƒèˆ‡å±€ vs è§€å¯Ÿå±€ï¼‰
pending_key = (table_id, round_id, strategy_key)
position = self._pending.pop(pending_key, None)

if not position:
    # âœ… è§€å¯Ÿå±€ï¼šè¨˜éŒ„åˆ°æ­·å²
    tracker.record(table_id, round_id, winner_code or "", timestamp)
    continue

# âœ… åƒèˆ‡å±€ï¼šä¸è¨˜éŒ„ï¼Œç›´æ¥çµç®—
```

---

### 3. âœ… çµ±ä¸€ round_id ç”Ÿæˆ

**å•é¡Œ**: round_id ä¸ä¸€è‡´å°è‡´å€‰ä½è¿½è¹¤å¤±æ•—
- PhaseDetector ç”Ÿæˆ: `detect-xxx_next`
- ResultDetector ç”Ÿæˆ: `detect-yyy`
- ä¸‹æ³¨æ™‚ä½¿ç”¨ `_next`ï¼Œçµç®—æ™‚æ‰¾ä¸åˆ°å€‰ä½

**ä¿®å¾©**:
- å‰µå»º `RoundManager` çµ±ä¸€ç®¡ç† round_id
- æ ¼å¼çµ±ä¸€: `round-{table_id}-{timestamp_ms}`
- ç§»é™¤ `_next` å¾Œç¶´æ··æ·†
- é›†æˆåˆ° `EngineWorker`

**å½±éŸ¿æ–‡ä»¶**:
- `src/autobet/round_manager.py` (æ–°æ–‡ä»¶ï¼Œline 84)
- `ui/workers/engine_worker.py` (line 1138-1152, 1462-1466)

**æ¸¬è©¦**:
- `test_round_manager_unified_ids()` âœ…
- `test_round_manager_participation_tracking()` âœ…

**é—œéµæ”¹é€²**:
- âœ… round_id æ ¼å¼çµ±ä¸€
- âœ… è¿½è¹¤åƒèˆ‡ç‹€æ…‹ (`is_participated`)
- âœ… æä¾› `should_include_in_history()` åˆ¤æ–·æ¥å£
- âœ… æ¨™è¨˜ä¸‹æ³¨å’Œçµç®—æ™‚é–“é»

---

### 4. âœ… ä¹¾è·‘æ¨¡å¼ä¿®å¾©

**å•é¡Œ**: ä¹¾è·‘æ¨¡å¼ä¸‹é»æ“Šå¤±æ•—æœƒæ‹‹å‡ºç•°å¸¸ï¼Œæ¸¬è©¦ç„¡æ³•å®Œæ•´é‹è¡Œã€‚

**ä¿®å¾©**:
- æª¢æŸ¥ `engine.dry` æ¨™èªŒ
- ä¹¾è·‘æ¨¡å¼ä¸‹å…è¨±é»æ“Šå¤±æ•—ï¼Œä¸æ‹‹å‡ºç•°å¸¸
- ä¿æŒæ‰€æœ‰å…¶ä»–é‚è¼¯ï¼ˆç›ˆè™§è¨ˆç®—ã€æ­·å²è¨˜éŒ„ï¼‰ç…§å¸¸é‹è¡Œ

**å½±éŸ¿æ–‡ä»¶**:
- `ui/workers/engine_worker.py` (line 1353-1389)

**é—œéµä»£ç¢¼**:
```python
is_dry_run = getattr(self.engine, 'dry', False)

click_result = self.engine.act.click_chip_value(chip.value)
if not click_result and not is_dry_run:  # åªåœ¨å¯¦æˆ°æ¨¡å¼æ‹‹ç•°å¸¸
    raise Exception(f"é»æ“Šå¤±æ•—: {chip_desc}")
```

---

### é©—è­‰æ–¹å¼

é‹è¡Œé›†æˆæ¸¬è©¦:
```bash
python test_p0_fixes.py
```

**æ¸¬è©¦çµæœ** (2025-10-24):
```
âœ… PASSED: test_deprecated_net_removal
âœ… PASSED: test_round_manager_unified_ids
âœ… PASSED: test_round_manager_participation_tracking
âœ… PASSED: test_orchestrator_participation_exclusion

ç¸½è¨ˆ: 4/4 æ¸¬è©¦é€šé
ğŸ‰ æ‰€æœ‰ P0 ä¿®å¾©é©—è­‰é€šéï¼
```

---

## é•·æœŸç›®æ¨™

å»ºç«‹ä¸€å€‹**æ¸…æ™°ã€å¯ç¶­è­·ã€æ˜“æ“´å±•**çš„æ¶æ§‹ï¼š

- æ–°äººå¯ä»¥å¿«é€Ÿç†è§£ä»£ç¢¼çµæ§‹
- æ·»åŠ æ–°åŠŸèƒ½ä¸æœƒç ´å£ç¾æœ‰åŠŸèƒ½
- å•é¡Œå¯ä»¥å¿«é€Ÿå®šä½å’Œä¿®å¾©
- å–®å…ƒæ¸¬è©¦å®¹æ˜“ç·¨å¯«
